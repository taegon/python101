<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>부록 A: 기상청 자료 받기 | Python 101</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/python101/logo.png">
    <meta name="description" content="대학원생을 위한 파이썬 기초">
    
    <link rel="preload" href="/python101/assets/css/0.styles.9b1dda7f.css" as="style"><link rel="preload" href="/python101/assets/js/app.dbb036ea.js" as="script"><link rel="preload" href="/python101/assets/js/2.95d799da.js" as="script"><link rel="preload" href="/python101/assets/js/20.64c64fbb.js" as="script"><link rel="prefetch" href="/python101/assets/js/10.36fde300.js"><link rel="prefetch" href="/python101/assets/js/11.13fb88b8.js"><link rel="prefetch" href="/python101/assets/js/12.9de15419.js"><link rel="prefetch" href="/python101/assets/js/13.f291c9a6.js"><link rel="prefetch" href="/python101/assets/js/14.553285a3.js"><link rel="prefetch" href="/python101/assets/js/15.e39fd445.js"><link rel="prefetch" href="/python101/assets/js/16.fc76248a.js"><link rel="prefetch" href="/python101/assets/js/17.518b50dd.js"><link rel="prefetch" href="/python101/assets/js/18.989d7fc4.js"><link rel="prefetch" href="/python101/assets/js/19.0fc45761.js"><link rel="prefetch" href="/python101/assets/js/3.cbcaddd8.js"><link rel="prefetch" href="/python101/assets/js/4.96519e85.js"><link rel="prefetch" href="/python101/assets/js/5.024706a7.js"><link rel="prefetch" href="/python101/assets/js/6.51655b54.js"><link rel="prefetch" href="/python101/assets/js/7.6709e416.js"><link rel="prefetch" href="/python101/assets/js/8.8319188a.js"><link rel="prefetch" href="/python101/assets/js/9.c034811f.js">
    <link rel="stylesheet" href="/python101/assets/css/0.styles.9b1dda7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/python101/" class="home-link router-link-active"><!----> <span class="site-name">Python 101</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/taegon/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://code.taegon.kr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/taegon/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://code.taegon.kr/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>강의자료</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>A. 부록</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/python101/ch80-download-weather.html" aria-current="page" class="active sidebar-link">부록 A: 기상청 자료 받기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python101/ch80-download-weather.html#간단한-api-사용법" class="sidebar-link">간단한 API 사용법</a></li><li class="sidebar-sub-header"><a href="/python101/ch80-download-weather.html#모든-측후소-최근-5년간-자료-받기" class="sidebar-link">모든 측후소 최근 5년간 자료 받기</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="부록-a-기상청-자료-받기"><a href="#부록-a-기상청-자료-받기" class="header-anchor">#</a> 부록 A: 기상청 자료 받기</h1> <p>기상청에서는 다양한 기상관측 자료를 홈페이지를 통해서 제공하고 있다. 특히 과거관측자료는 수문 및 관개 분야에서 주 입력자료로 활용된다.</p> <p>하지만 기상청에서 제공하는 과거일별관측자료는 1년 단위로 1개의 측후소에 대하여, 1개의 관측자료를 테이블 형태로 제공한다. 그래서 지역시스템공학과 및 농공학에 기반을 둔 유사학과에서 연구실 막내가 의례적으로 하는 일 중 하나가 기상청 자료를 받아서 엑셀로 저장하는 일이다. 내가 학교를 다니던 10년이 넘는 시간동안 계속 되어온 풍습이 최근 몇년 동안 바뀌었을 것이라고 생각하진 않는다.</p> <p>이러한 문제의식에서 기상청 과거일별자료를 좀 더 쉽게 받을 수 있는 서비스를 만들어보면 좋겠다고 생각했고, 관련 내용은 농공학회 56권 6호에 실린 &quot;데이터 로딩 자동화를 위한 RESTful 웹서비스 개발 -일별 기상자료 처리를 중심으로-&quot; 논문을 참고하기 바란다. 비록 4년이나 된 논문이나, 여러분이 처한 사정은 크게 달라지지 않았을 것이므로, 여전히 도움이 될 것이다.</p> <h2 id="간단한-api-사용법"><a href="#간단한-api-사용법" class="header-anchor">#</a> 간단한 API 사용법</h2> <p>이미 교수님을 통해서 몇번 사용해 보았을 것으로 생각된다. 물론 위에 써놓은 논문은 찾아보지 않았을 것도 잘 안다. 안 읽어도 상관 없으니, 일단 계속 진행해보자.</p> <p>측후소 119번 (수원)의 2011년부터 2015년까지의 기상 자료를 확인해보자. 브라우저를 열고 아래 주소를 쓰면 된다.</p> <p><code>https://api.taegon.kr/station/119/?sy=2011&amp;ey=2015&amp;format=html</code></p> <p>자 그러면, 2014년부터 최근 날짜까지 기상자료를 구하려면 어떻게 해야할까?</p> <p><code>https://api.taegon.kr/station/119/?sy=2014&amp;ey=2018&amp;format=html</code></p> <p>무엇을 바꾸었는지 눈치챘는가? 측후소 번호(<code>119</code>)와 시작연도(<code>sy=2014</code>), 끝연도(<code>ey=2018</code>)만 원하는대로 바꿔주면 된다.</p> <p>이렇게 보이는 파일은 엑셀에서 웹자원 불러오기 기능을 이용하여 그대로 이용할 수 있다. 하지만 우리는 프로그래밍에서 다루기 쉬운 파일을 배웠다. 바로 CSV 파일이다.</p> <p>위에서 설명하지 않는 나머지 한 인자 (<code>format=html</code>)대신 <code>format=csv</code>를 써보자. 방금 브라우저에서 본 결과가 파일로 다운받아지는 것을 확인할 수 있을 것이다. 사실 이만큼만 해도 꽤 편리해진 것이 사실이다. 하지만 여기까지 하려고 이런 걸 만든 건 아니다.</p> <h2 id="모든-측후소-최근-5년간-자료-받기"><a href="#모든-측후소-최근-5년간-자료-받기" class="header-anchor">#</a> 모든 측후소 최근 5년간 자료 받기</h2> <p>이런식으로 웹 주소를 통해 서비스를 제공하는 형태를 Open API 혹은 RESTful API라고 한다. 보다 정확히 말하자면, 여기서 소개한 서비스는 HTTP API라고 쓰는 게 적확하지만, 보고서나 제안서에 쓰기에는 앞서 기술한 단어가 훨씬 유용하다.</p> <p>어쨌거나 API라고 하는 것은 프로그램 간에 서로 자료를 주고 받기 위한 약속이라는 의미이다. 즉 사람이 쓰기 편하게 만든 것이 아니라, 프로그램이 쓰기 편하게 만든 약속이라는 것이다. 그래서 우리가 배운 프로그래밍 지식을 활용하면, 모든 측후소의 최근 5년간 자료를 받는데, 코드 수십 줄로 해결할 수 있게 되는 것이다.</p> <p>각설하고 코드부터 살펴보자.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    station_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">]</span>
    output_dir <span class="token operator">=</span> <span class="token string">&quot;../../output/python101/weather/&quot;</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span>

    url <span class="token operator">=</span> <span class="token string">'https://api.taegon.kr/stations/{}/?sy=2014&amp;ey=2018&amp;format=csv'</span>
    <span class="token keyword">for</span> st_id <span class="token keyword">in</span> station_ids<span class="token punctuation">:</span>
        download_url <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>st_id<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>download_url<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_dir <span class="token operator">+</span> <span class="token string">&quot;{}.csv&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>st_id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>이 코드가 전부이다. 예제로 측후소 리스트는 2개만 적어두었는데, 전체 리스트를 만드는 방법은 여러번 설명하였으므로 생략한다. 파일을 쓸 디렉토리를 설정하고, 해당 디렉토리가 없을 때는 만들도록 하였다. 그 다음은 앞서 소개한 API 주소를 지정하고 있다. 모든 인자는 동일하고, 측후소 번호만 바뀌게 되므로, 수정할 곳을 하나만 지정하였다.</p> <p><code>for</code> 문에서는 앞서 리스트로 준 측후소를 차례대로 넘겨주면서, <code>download_url</code>이라는 주소를 만들고, 이 주소에 접속하여 자료를 받는다. <code>requests.get()</code> 부분이 웹을 통해서 자료를 받는 부분이고, 받은 자료는 메모리에 올라가 있으므로, 이를 지정한 파일에 저장하기 위하여 <code>f.write()</code>를 실행하고 있다. 이게 전부이다.</p> <p>여기서, <code>requests</code> 모듈이 깔려있지 않다고 에러가 날 수 있는데, PyCharm에서 <code>파일&gt;설정 (Ctrl+Alt+S)</code>를 들어가서, 왼쪽 항목 중 &quot;Project: ..&quot;로 시작하는 항목 바로 아래 &quot;Project Interpreter&quot;를 선택한다. 그러면 설치면 모듈을 확인할 수 있는데, 오른쪽의 &quot;+&quot;버튼을 이용하여 모듈을 설치하면 된다.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/15/2022, 10:24:45 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/python101/ch10-GIS-table.html" class="prev">
        GIS용 자료구축하기
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/python101/assets/js/app.dbb036ea.js" defer></script><script src="/python101/assets/js/2.95d799da.js" defer></script><script src="/python101/assets/js/20.64c64fbb.js" defer></script>
  </body>
</html>
